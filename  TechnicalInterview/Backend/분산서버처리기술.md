# 분산서버 처리 기술 - 면접 대비

### 특정 서버에 대해 대량의 트래픽이 몰린다면 어떻게 대처할 것인지 설명해주세요.
- 대량의 트래픽이 특정 서버에 몰리는 현상이 일시적인 상황이라면 서버를 여러 대 추가하여 시스템을 증가시키는 스케일 아웃(Scale Out)을 합니다.
- 만약 지속적인 상황이라면 서버의 CPU나 RAM 등을 추가하여 서버의 하드웨어 스펙을 향상시키는 스케일 업(Scale Up)을 합니다.

~~~
스케일 업(Scale Up): 서버에 CPU나 RAM 등을 추가하여 서버의 하드웨어 스펙을 향상시키는 방법
스케일 아웃(Scale Out): 서버를 여러 대 추가하여 시스템을 증가시키는 방법
~~~

### 분산서버 처리를 위한 기술들에 대해 아는대로 설명해주세요.
- 1) 로드 밸런싱(Load Balancing)
    - 부하 분산을 위해 가상 IP를 통해 각 서버에 Request를 분배하는 기능
- 2) Scale out
    - 대부분의 클라우드 서비스 제공 업체들은 Auto Scaling기능을 지원
    - 서버의 CPU, RAM등의 부하를 체크하여 서버를 자동으로 늘렸다가 줄여주는 기능.
- 3) Stateless 설계
    - 분산 서버 처리를 위해서는 모든 요청이 stateless(상태를 저장하고 있지 않은)한 것이 유리하다.
    - 다음과 같은 내용을 고려하여 자신의 서비스에 맞게 설계하면 된다.
        - 세션 관리는 로컬 파일구조가 아닌 별도의 Redis나 MongoDB를 이용한다.(한 서버에서 로컬파일로 저장할 경우 해당 서버가 다운 될 경우에 문제가 생김)
        - 또한 파일 저장시에도 로컬에 사용하지 않는다. AWS의 S3나 클라우드 스토리지 시스템을 이용하는 것이 유리하다.
        -  내부 서버에서만 동작하는 서비스(예를 들면 socket.io) 의 stateless 여부를 확인해야 한다.(내부적으로 로컬에서 쓰는 부분을 DB를 사용하게 하면 해결된다.)
        - 데이터베이스는 분리하여 구성해야 한다.

- 4) 데이터베이스의 샤딩
    - 데이터베이스 또한 확장이 가능한 구조가 필요하기에 대부분의 데이터베이스가 샤딩을 통한 scale-out을 지원한다.
    - 레플리카도 거의 필수로 구축을 해야하는데, 이는 가용성, 무결성, 두 가지를 모두 만족시킨다.
- 5) CDN(Content Delivery Network)사용
    - Css, Javascript, Image 등 잘 변하지 않는 리소스들은 CDN에서 관리하는 것이 트래픽 절감에 매우 유리하다.
- 6) Micro Service
    - 서비스 별로 가지는 특성들이 다르다. 예를 들면 어떤 서비스는 비동기식으로 빠르게 처리해야 할 필요가 있을 경우 NodeJS로 구성될 수 있고 다른 어떤 서비스는 여러가지 트랜잭션 처리가 필요할 수 있어 SpringBoot로 구성될수도 있다.
    - 즉, 독립적인 기능을 가지면서 별도의 서비스로 분리하여 구축할 필요가 있기에 전체적인 애플리케이션을 작은 단위의 서비스로 쪼개 구성하는 MSA방식으로 구성하면 분산처리에 도움이 된다.

### 로드 밸런서 사용 시의 이슈중 세션데이터와 관련된 이슈에 대해 설명해주세요.
- 로드 밸런서에 의해 이전 요청과 현 요청에 분배되는 서버가 다를 경우 세션 관리 일관성에 문제가 발생한다. 해결 방법은 다음과 같다.

- 1) sticky session
    - sticky session이란 로드 밸런서가 세션id에 기반하여 특정 서버로 보내주는 방식이다.(특정 세션의 요청을 처음 처리한 서버로만 보내는 방식)
    - 하지만 sticky session은 특정 서버가 다운되었을 경우 보관하고 있는 세션이 손실되거나 특정 서버만 과부하 되는 단점이 존재한다.

- 2) Session Clustering기법
    - sticky session의 단점을 보완할 수 있는 방식으로 여러 WAS의 세션을 동일한 세션으로 관리하는 방식이다.
    - 각 WAS들은 세션을 각각 가지고 있지만, 이를 하나로 묶어 클러스터로 관리하는 것이다. 이 상태에서 하나의 WAS가 fail발생하면 WAS가 들고 있던 세션은 다른 WAS로 이동되어 그 WAS가 해당 세션을 관리해줘야한다.
    - 하지만 Session Clustering의 단점으로는 scale out 관점에서 새로운 서버가 하나 뜰 때마다 기존에 존재하던 WAS에 새로운 서버의 IP/Port를 입력해서 클러스터링해줘야 하는 번거로움이 있다. 그리하여 새로운 서버를 띄울 경우 기존 서버에 수정이 발생하고, 휴먼 에러가 발생할 가능성도 충분히 존재한다.

- 3) Redis와 같은 세션 서버를 분리하는 방식
    - Session Clustering기법의 단점을 극복하기 위해 세션 서버를 별도로 분리하는 방식이다. 
    - 새로운 서버를 띄우더라도 해당 서버에만 세션 서버의 정보를 적어주고 연결 해주면 되기 때문에 scale out시 기존 서버의 수정이 발생하지 않게 된다. 
    - 그리하여 Redis Session 서버의 중요성이 점점 올라가며, 해당 세션 서버가 죽는 순간 모든 세션이 사라지기에 Redis 서버의 Replication설정도 필수로 수반된다.


#### 출처
- https://mangkyu.tistory.com/95
- https://www.devkwon.com/posts/category/%EB%B6%84%EC%82%B0%EC%84%9C%EB%B2%84%EC%B2%98%EB%A6%AC
- https://kkwonsy.tistory.com/66
- https://smjeon.dev/web/sticky-session/