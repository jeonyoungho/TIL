# LoadBalancer

## LoadBalancer란?
- 부하 분산을 위해 가상 IP를 통해 각 서버에 Request를 분배하는 기능

## 로드 밸런서 사용 시의 이슈중 세션데이터와 관련된 이슈
- 로드 밸런서에 의해 이전 요청과 현 요청에 분배되는 서버가 다를 경우 세션 관리 일관성에 문제가 발생한다. 해결 방법은 다음과 같다.

- 1) sticky session 사용
    - sticky session이란 로드 밸런서가 세션id에 기반하여 특정 서버로 보내주는 방식이다.(특정 세션의 요청을 처음 처리한 서버로만 보내는 방식)
    - 하지만 sticky session은 특정 서버가 다운되었을 경우 보관하고 있는 세션이 손실되거나 특정 서버만 과부하 되는 단점이 존재한다.

- 2) Session Clustering기법
    - sticky session의 단점을 보완할 수 있는 방식으로 여러 WAS의 세션을 동일한 세션으로 관리하는 방식이다.
    - 각 WAS들은 세션을 각각 가지고 있지만, 이를 하나로 묶어 클러스터로 관리하는 것이다. 이 상태에서 하나의 WAS가 fail발생하면 WAS가 들고 있던 세션은 다른 WAS로 이동되어 그 WAS가 해당 세션을 관리해줘야한다.
    - 하지만 Session Clustering의 단점으로는 scale out 관점에서 새로운 서버가 하나 뜰 때마다 기존에 존재하던 WAS에 새로운 서버의 IP/Port를 입력해서 클러스터링해줘야 하는 번거로움이 있다. 그리하여 새로운 서버를 띄울 경우 기존 서버에 수정이 발생하고, 휴먼 에러가 발생할 가능성도 충분히 존재한다.

- 3) Redis와 같은 세션 서버를 분리하는 방식
    - Session Clustering기법의 단점을 극복하기 위해 세션 서버를 별도로 분리하는 방식이다. 
    - 새로운 서버를 띄우더라도 해당 서버에만 세션 서버의 정보를 적어주고 연결 해주면 되기 때문에 scale out시 기존 서버의 수정이 발생하지 않게 된다. 
    - 그리하여 Redis Session 서버의 중요성이 점점 올라가며, 해당 세션 서버가 죽는 순간 모든 세션이 사라지기에 Redis 서버의 Replication설정도 필수로 수반된다.

#### 출처
- https://smjeon.dev/web/sticky-session/